<div class="container mt-4">
  <h1>Preservation System Status Overview</h1>

  <h2 class="mt-5">Object Status Errors</h2>
  <table class="table" id="status-errors-table">
    <thead>
      <tr>
        <th scope="col">Record type</th>
        <th scope="col">With errors</th>
        <th scope="col">Stuck</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">MoabRecords</th>
        <td><%= link_to number_with_delimiter(MoabRecord.with_errors.count), with_errors_dashboard_moab_records_path %></td>
        <td><%= link_to number_with_delimiter(MoabRecord.stuck.count), stuck_dashboard_moab_records_path %></td>
      </tr>
      <tr>
        <th scope="row">ZippedMoabVersions</th>
        <td><%= link_to number_with_delimiter(ZippedMoabVersion.with_errors.count), with_errors_dashboard_zipped_moab_versions_path %></td>
        <td><%= link_to number_with_delimiter(ZippedMoabVersion.stuck.count), stuck_dashboard_zipped_moab_versions_path %></td>
      </tr>
    </tbody>
  </table>

  <%= render CardComponent.new do %>
    <p class="fw-semibold">Any errors shown above require investigation.</p>
    <p class="mb-1"><span class="fw-medium">Stuck for MoabRecords:</span> status of <italic>validity_unknown</italic> for more than a week</p>
    <p class="mb-1"><span class="fw-medium">Stuck for ZippedMoabVersions:</span> status of <italic>created</italic> or <italic>incomplete</italic> for more than a week</p>
    <p>Each of the stuck statuses should be transient; if they persist, that indicates a problem.</p>
  <% end %>

  <hr class="my-5">

  <h2>System Level Warnings</h2>

  <table class="table" id="system-warnings-table">
    <thead>
      <tr>
        <th scope="col">Warning</th>
        <th scope="col">Count</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">MoabRecord with validity_unknown status</th>
        <td><%= number_with_delimiter(MoabRecord.validity_unknown_count) %></td>
      </tr>
      <tr>
        <th scope="row">ZippedMoabVersions with created status</th>
        <td><%= number_with_delimiter(ZippedMoabVersion.created_count) %></td>
      </tr>
      <tr>
        <th scope="row">ZippedMoabVersions with incomplete status</th>
        <td><%= link_to number_with_delimiter(ZippedMoabVersion.incomplete_count), incomplete_dashboard_zipped_moab_versions_path %></td>
      </tr>
      <tr>
        <th scope="row">Missing ZippedMoabVersions</th>
        <td><%= number_with_delimiter(ZippedMoabVersion.missing_count) %></td>
      </tr>
      <tr>
        <th scope="row">Expired MoabRecord checksum validations + 7 day grace</th>
        <td><%= number_with_delimiter(MoabRecord.expired_checksum_validation_with_grace_count) %></td>
      </tr>
      <tr>
        <th scope="row">Expired PreservedObject replication audits + 7 day grace</th>
        <td><%= number_with_delimiter(PreservedObject.expired_archive_audit_with_grace_count) %></td>
      </tr>
    </tbody>
  </table>

  <%= render CardComponent.new do %>
    <p class="fw-semibold">Large counts for any of the above may indicate system level issues that need investigation.</p>
    <p>In normal operation, a small number of objects in these states is expected.</p>
    <%= link_to 'Sidekiq Dashboard', sidekiq_web_path, class: 'card-link' %>
  <% end %>
</div>
